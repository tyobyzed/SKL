<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengumuman Kelulusan 2025</title>
    <link rel="stylesheet" href="style.css">

    <!-- jsPDF untuk generate surat PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <!-- Google Visualization API -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>

    <div class="container">
        <img src="logo-sekolah.png" alt="Logo Sekolah" class="logo">

        <div class="form-box">
            <h1>Pengumuman Kelulusan 2025</h1>
            <p>Silakan masukkan NISN Anda</p>

            <input type="text" id="nisn" placeholder="NISN" required>
            <button onclick="cekKelulusan()">Cek Kelulusan</button>

            <div id="hasil" class="hasil"></div>
            <button id="downloadBtn" style="display:none;" onclick="downloadPDF()">Download Surat Kelulusan</button>
        </div>
    </div>

    <script>
        // Inisialisasi data kelulusan dari Google Sheets
        let dataKelulusan = [];

        // Muat data dari Google Sheets menggunakan Google Visualization API
        google.charts.load('current', {
            packages: ['table']
        });
        
        google.charts.setOnLoadCallback(loadDataFromSheets);

        function loadDataFromSheets() {
            const queryString = "SELECT A, B, C";  // Sesuaikan dengan kolom data NISN, Nama, dan Status kelulusan
            const spreadsheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTAlsCAkwkm5_WQ1UrtOUUCh0q4rthSZjtRlzM5MLYj-lccy_vGsgM9aTk8e0NPLRCEdjMv646h5NGh/pubhtml?gid=0&single=true";

            const query = new google.visualization.Query(spreadsheetUrl);
            query.setQuery(queryString);

            query.send(function(response) {
                const data = response.getDataTable();
                dataKelulusan = [];
                for (let i = 0; i < data.getNumberOfRows(); i++) {
                    dataKelulusan.push({
                        nisn: data.getValue(i, 0),
                        nama: data.getValue(i, 1),
                        status: data.getValue(i, 2)
                    });
                }
            });
        }

        function cekKelulusan() {
            const nisnInput = document.getElementById("nisn").value.trim();
            const hasilDiv = document.getElementById("hasil");
            const downloadBtn = document.getElementById("downloadBtn");

            const siswa = dataKelulusan.find(s => s.nisn === nisnInput);

            if (siswa) {
                hasilDiv.innerHTML = `<h2>Selamat ${siswa.nama}</h2><p>Status: <strong>${siswa.status}</strong></p>`;
                if (siswa.status === "LULUS") {
                    downloadBtn.style.display = "inline-block";
                } else {
                    downloadBtn.style.display = "none";
                }
            } else {
                hasilDiv.innerHTML = `<p style="color:red;">NISN tidak ditemukan.</p>`;
                downloadBtn.style.display = "none";
            }
        }

        function downloadPDF() {
            const nisnInput = document.getElementById("nisn").value.trim();
            const siswa = dataKelulusan.find(s => s.nisn === nisnInput);

            if (!siswa) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont("helvetica", "bold");
            doc.setFontSize(16);
            doc.text("SURAT KETERANGAN KELULUSAN", 20, 30);

            doc.setFont("helvetica", "normal");
            doc.setFontSize(12);
            doc.text(`Nama: ${siswa.nama}`, 20, 50);
            doc.text(`NISN: ${siswa.nisn}`, 20, 60);
            doc.text(`Status Kelulusan: ${siswa.status}`, 20, 70);

            doc.text("Selamat atas kelulusan Anda.", 20, 90);
            doc.text("Kepala Sekolah", 20, 120);
            doc.text("__________________________", 20, 140);

            doc.save(`Surat_Kelulusan_${siswa.nisn}.pdf`);
        }
    </script>

</body>
</html>
